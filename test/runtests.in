#!/bin/sh
PREFIX="@PREFIX@"
SRCDIR="@SRCDIR@"

cd "$(dirname "$0")" || exit 1
if [ x"$PREFIX" != x"$SRCDIR/test/tmp" ]
then
	echo "configure prefix was not set properly for testing"
	echo "Re-run configure with --prefix='$(pwd)/tmp'"
	exit 1
fi

sed -e "s,[@]TMPDIR[@],$PREFIX,g; s,[@]SRCDIR[@],$SRCDIR,g;" < functions.in > functions

failed=0
for test in $*
do
	echo Running test $test...
	if env - bash $test
	then
		echo 'Done.'
	else
		echo '******************************Failed!******************************'
		failed=1
	fi
done 2>&1
exit $failed
